<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.43">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Nora Elliott">
<meta name="dcterms.date" content="2025-04-07">
<meta name="description" content="This blog explores how AI generated influencers like Lil Miquela are reshaping the influencer marketing landscape and offering brands unprecedented control, while raising ethical questions of digital authenticity.">

<title>Real or Rendered? The Rise of AI Generated Influencers in Digital Marketing – My Explorations with LLMs</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-d4d76bf8491c20bad77d141916dc28e1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-5e113afdac1e418f162bce274ee92ddb.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">My Explorations with LLMs</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com"> <i class="bi bi-twitter" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Real or Rendered? The Rise of AI Generated Influencers in Digital Marketing</h1>
                  <div>
        <div class="description">
          This blog explores how AI generated influencers like Lil Miquela are reshaping the influencer marketing landscape and offering brands unprecedented control, while raising ethical questions of digital authenticity.
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">LLMs</div>
                <div class="quarto-category">Logic</div>
                <div class="quarto-category">Marketing</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Nora Elliott </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">April 7, 2025</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<section id="could-a-virtual-persona-replace-real-influencers" class="level1">
<h1>Could a Virtual Persona Replace Real Influencers?</h1>
<p>In the ever evolving world of influencer marketing, brands are no longer limited to partnering with human personalities. The AI generated influencer is a virtual persona powered by algorithms, designed to emulate the aesthetic, behavior, and social impact of a real person. These personas, like Lil Miquela and Imma, are gaining massive followings, scoring brand deals, and sparking a provocative question: Could AI generated influencers eventually replace real ones?</p>
<p>This blog post will explore how these virtual influencers are created, their impact on marketing strategies, and the implications for the future of digital branding.</p>
<section id="meet-the-ai-generated-influencer" class="level2">
<h2 class="anchored" data-anchor-id="meet-the-ai-generated-influencer">Meet the AI-Generated Influencer</h2>
<p><img src="Post15_files/figure-html/0de12348-fb29-4c53-9a24-172f627521a7-7-decb64e8-bbfc-4066-b903-96f30e263414.jpg" class="img-fluid"></p>
<p>Lil Miquela, arguably the poster child of virtual influencers, debuted on Instagram in 2016. Designed by the startup Brud, Lil Miquela is a computer generated Brazilian American “19-year-old” who wears Prada, advocates for social justice, and drops pop singles. With over 2 million followers, she’s modeled for Calvin Klein, appeared in Vogue, and collaborated with brands like Samsung and UGG.</p>
<p>But Lil Miquela isn’t the only one. Japan’s Imma, South Korea’s Rozy, and China’s Ayayi are all part of a growing wave of virtual influencers who are blurring the line between fiction and reality.</p>
</section>
<section id="how-do-ai-influencers-actually-work" class="level2">
<h2 class="anchored" data-anchor-id="how-do-ai-influencers-actually-work">How Do AI Influencers Actually Work?</h2>
<p>Despite being branded as “AI,” many virtual influencers are currently a hybrid of human creativity and machine learning. While some aspects, like facial animation, tone, and narrative decisions, are designed by creative teams, others are increasingly guided by data.</p>
<section id="heres-what-goes-on-behind-the-scenes" class="level4">
<h4 class="anchored" data-anchor-id="heres-what-goes-on-behind-the-scenes">Here’s what goes on behind the scenes:</h4>
<p><img src="Post15_files/figure-html/0de12348-fb29-4c53-9a24-172f627521a7-3-678aa449-404b-44bb-b07e-8f42fb4e4da9.avif" class="img-fluid"></p>
<ol type="1">
<li>3D Modeling &amp; CGI Design – Artists use photorealistic rendering and animation tools to bring virtual influencers to life.</li>
<li>Content Strategy – Machine learning can help determine optimal posting times, trending hashtags, and even suggest captions or responses based on NLP tools.</li>
<li>Audience Engagement – AI tools analyze follower data to simulate personalized interactions, increasing engagement rates.</li>
<li>Brand Alignment – Algorithms can assess brand values and campaign goals to match virtual influencers with the most synergistic partnerships.</li>
</ol>
</section>
<section id="as-technology-advances-ai-models-may-soon-handle-real-time-content-creation-and-audience-interaction-with-minimal-human-oversight." class="level4">
<h4 class="anchored" data-anchor-id="as-technology-advances-ai-models-may-soon-handle-real-time-content-creation-and-audience-interaction-with-minimal-human-oversight.">As technology advances, AI models may soon handle real time content creation and audience interaction with minimal human oversight.</h4>
<p><img src="Post15_files/figure-html/0de12348-fb29-4c53-9a24-172f627521a7-6-ceae6811-0900-4860-a524-5c282e51b61f.png" class="img-fluid"></p>
</section>
</section>
<section id="why-brands-are-turning-to-virtual-influencers" class="level2">
<h2 class="anchored" data-anchor-id="why-brands-are-turning-to-virtual-influencers">Why Brands Are Turning to Virtual Influencers</h2>
<p>The appeal of AI-generated influencers is not just novelty… it’s control, efficiency, and creative flexibility.</p>
<ol type="1">
<li>Total Brand Control</li>
</ol>
<p>Unlike human influencers, virtual personalities won’t tweet something controversial at 2 a.m. or unexpectedly switch allegiances to a competitor. Their image, message, and partnerships can be perfectly curated.</p>
<ol start="2" type="1">
<li>Lower Risk, Higher ROI</li>
</ol>
<p>AI influencers don’t age, don’t get caught in scandals (unless scripted to), and never call in sick. This consistency can lead to more stable and predictable marketing outcomes.</p>
<ol start="3" type="1">
<li>Hyper Personalization at Scale</li>
</ol>
<p>AI tools can generate localized content for different markets, something no single human could replicate.</p>
<ol start="4" type="1">
<li>Viral Novelty</li>
</ol>
<p>Virtual influencers are weird, fascinating, and conversation starting. In a crowded digital space, that edge matters.</p>
</section>
<section id="real-vs.-virtual-who-has-the-influence" class="level2">
<h2 class="anchored" data-anchor-id="real-vs.-virtual-who-has-the-influence">Real vs.&nbsp;Virtual: Who Has the Influence?</h2>
<p>Despite the high engagement and visual polish of AI-generated influencers, they still face major limitations. <img src="Post15_files/figure-html/0de12348-fb29-4c53-9a24-172f627521a7-2-44c34c2f-6351-4a76-af88-1958b4395fa4.png" class="img-fluid"></p>
<ol type="1">
<li>The Trust Factor</li>
</ol>
<p>Studies show that audiences are more likely to trust recommendations from real people, especially micro influencers with smaller but more loyal followings. When followers know an influencer is entirely fictional, the sense of authenticity can weaken.</p>
<ol start="2" type="1">
<li>Emotional Connection</li>
</ol>
<p>Authentic storytelling is what makes influencer marketing so powerful. AI generated personas can imitate empathy, but they can’t feel it. That emotional gap can create a ceiling on long term impact.</p>
<ol start="3" type="1">
<li>Ethical Gray Areas</li>
</ol>
<p>Who’s accountable for what a virtual influencer says? Is it ethical to create a persona that advocates for marginalized groups without truly belonging to that group? These questions raise important challenges for brands that want to appear inclusive without crossing into exploitation.</p>
</section>
<section id="case-study-lil-miquela-x-calvin-klein" class="level2">
<h2 class="anchored" data-anchor-id="case-study-lil-miquela-x-calvin-klein">Case Study: Lil Miquela x Calvin Klein</h2>
<p><img src="Post15_files/figure-html/0de12348-fb29-4c53-9a24-172f627521a7-1-38caeb08-98e5-4dbc-a355-03ff21f0efb4.jpg" class="img-fluid"> <img src="Post15_files/figure-html/0de12348-fb29-4c53-9a24-172f627521a7-8-e6f95161-277d-42e2-a6d2-270d93921989.jpg" class="img-fluid"> <img src="Post15_files/figure-html/0de12348-fb29-4c53-9a24-172f627521a7-4-a5d9a5b2-5b1d-432c-8368-51379716a6f0.webp" class="img-fluid"></p>
<p>When Lil Miquela starred in a Calvin Klein campaign alongside model Bella Hadid in 2019, the internet was stunned. The ad was designed to push boundaries. But it also sparked backlash over queerbaiting and the ethics of using a fictional character to simulate LGBTQ+ representation.</p>
<section id="the-lesson" class="level4">
<h4 class="anchored" data-anchor-id="the-lesson">The lesson?</h4>
<p>While AI influencers offer creative freedom, they also demand ethical responsibility. What seems like innovation can easily slide into misrepresentation if brands aren’t thoughtful.</p>
</section>
<section id="could-virtual-influencers-replace-human-ones" class="level4">
<h4 class="anchored" data-anchor-id="could-virtual-influencers-replace-human-ones">Could Virtual Influencers Replace Human Ones?</h4>
</section>
<section id="technically-maybe.-practically-its-complicated." class="level4">
<h4 class="anchored" data-anchor-id="technically-maybe.-practically-its-complicated.">Technically? Maybe. Practically? It’s complicated.</h4>
<p>When weighing the strengths of human influencers versus their AI generated counterparts, the tradeoffs are clear.</p>
<p>Human influencers bring authenticity, emotional depth, and a sense of lived experience that resonates with audiences on a personal level. They can build genuine trust and cultivate loyal communities over time.</p>
<p>On the other hand, virtual influencers offer unmatched scalability, total brand control, and a high novelty factor that can capture attention in an oversaturated market. However, they often struggle with conveying real emotional nuance and navigating ethical complexities, especially when portraying identities or experiences they don’t authentically possess.</p>
</section>
<section id="in-short-while-virtual-influencers-offer-exciting-opportunities-for-innovation-and-control-they-still-fall-short-of-replicating-the-deeply-human-connections-that-drive-the-most-effective-and-enduring-influencer-campaigns." class="level4">
<h4 class="anchored" data-anchor-id="in-short-while-virtual-influencers-offer-exciting-opportunities-for-innovation-and-control-they-still-fall-short-of-replicating-the-deeply-human-connections-that-drive-the-most-effective-and-enduring-influencer-campaigns.">In short, while virtual influencers offer exciting opportunities for innovation and control, they still fall short of replicating the deeply human connections that drive the most effective and enduring influencer campaigns.</h4>
<p><img src="Post15_files/figure-html/0de12348-fb29-4c53-9a24-172f627521a7-5-aad46756-6f06-404d-a732-abf207977d0b.webp" class="img-fluid"></p>
<p>Virtual influencers are here to stay, but not necessarily to replace. Instead, they’re expanding the toolkit of what influencer marketing can be.</p>
</section>
<section id="the-future-of-ai-driven-influence" class="level3">
<h3 class="anchored" data-anchor-id="the-future-of-ai-driven-influence">The Future of AI-Driven Influence</h3>
<p>The rise of AI generated influencers is a reflection of our digital age. As models become more sophisticated, we might see influencers who can generate video content in real time, adapt to live comments, or co host product launches in the metaverse.</p>
<section id="still-humans-crave-connection." class="level4">
<h4 class="anchored" data-anchor-id="still-humans-crave-connection.">Still, humans crave connection.</h4>
<p>The most effective marketing often comes from stories that resonate emotionally, not just algorithmically. The future may belong to hybrid models: where human influencers work alongside virtual ones, or real creators use AI tools to amplify their reach and creativity</p>


</section>
</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/noraelli\.github\.io\/comm4190_S25_Using_LLMs_Blog\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>